# منع الوصول المباشر للملفات الحساسة
<FilesMatch "\.(env|config|log|sql|md|gitignore|gitattributes|lock)$">
    Order allow,deny
    Deny from all
</FilesMatch>

# منع عرض محتويات المجلدات
Options -Indexes

# منع hotlinking للصور
RewriteEngine on
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?asirshades\.net [NC]
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?localhost [NC]
RewriteRule \.(jpg|jpeg|png|gif|webp)$ - [NC,F,L]

# حماية من XSS و Injection
<IfModule mod_headers.c>
    Header set X-XSS-Protection "1; mode=block"
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
    
    # سياسة أمان المحتوى (CSP)
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' https://fonts.googleapis.com https://www.googletagmanager.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; img-src 'self' https://mzalt-kas.mzltas.com https://images.unsplash.com data:; connect-src 'self';"
</IfModule>

# إعادة التوجيه HTTPS القسري
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]

# منع بعض الأساليب الضارة
RewriteCond %{REQUEST_METHOD} ^(HEAD|TRACE|DELETE|TRACK|DEBUG) [NC]
RewriteRule ^(.*)$ - [F,L]

# حماية ضد SQL injection (للملفات PHP لو وجدت)
<IfModule mod_rewrite.c>
    RewriteCond %{QUERY_STRING} (\<|%3C).*script.*(\>|%3E) [NC,OR]
    RewriteCond %{QUERY_STRING} GLOBALS(=|\[|\%[0-9A-Z]{0,2}) [OR]
    RewriteCond %{QUERY_STRING} _REQUEST(=|\[|\%[0-9A-Z]{0,2})
    RewriteRule ^(.*)$ index.php [F,L]
</IfModule>

# تعطيل ملفات معينة
<Files ~ "\.(inc|bak|config|sh|sql|fla|psd|log|sh)$">
    Order allow,deny
    Deny from all
</Files>

# إعدادات كلمات المرور للدلائل
<FilesMatch "^\.ht">
    Require all denied
</FilesMatch>
